<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz App</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    #options button { display: block; margin: 5px 0; padding: 10px; width: 100%; }
    #score-container, #navigation { margin-top: 20px; text-align: center; }
    #navigation select { padding: 5px; }
    #navigation button { margin-left: 10px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>Quiz App</h1>

  <div id="quiz-container">
    <div id="question"></div>
    <div id="options"></div>
    <button onclick="finishQuiz()">Finish Test</button>

    <div id="navigation">
      <label for="questionSelect">Go to question:</label>
      <select id="questionSelect"></select>
      <button onclick="goToQuestion()">Go</button>
    </div>
  </div>

  <div id="score-container" style="display: none;">
    <h2 id="score-text"></h2>
    <button onclick="restartQuiz()">Try Again</button>
  </div>

  <script>
    const DATA_URL = "https://script.google.com/macros/s/AKfycbwey0dl1JegdZT9OaIPIet7c49yfn6lwCvLLuVW9l8zmWs_S-IZUXdk5YNk3i8-5lcdfg/exec";

    let questions = [];
    let currentQuestionIndex = parseInt(localStorage.getItem("currentIndex")) || 0;
    let score = parseInt(localStorage.getItem("score")) || 0;
    let answered = JSON.parse(localStorage.getItem("answered") || "[]");

    async function fetchQuestions() {
      try {
        const res = await fetch(DATA_URL);
        const data = await res.json();

        questions = data.map(q => ({
          question: q.Question,
          options: [q["Option 1"], q["Option 2"], q["Option 3"], q["Option 4"], q["Option 5"]],
          answer: ["Option 1", "Option 2", "Option 3", "Option 4", "Option 5"].indexOf(q["Correct Option"])
        }));

        populateDropdown();
        loadQuestion();
      } catch (error) {
        alert("Failed to load questions.");
        console.error(error);
      }
    }

    function loadQuestion() {
      if (currentQuestionIndex >= questions.length) return showScore();

      const q = questions[currentQuestionIndex];
      document.getElementById("question").textContent = `${currentQuestionIndex + 1}. ${q.question}`;

      const optionsContainer = document.getElementById("options");
      optionsContainer.innerHTML = "";

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(i);
        optionsContainer.appendChild(btn);
      });

      saveProgress();
    }

    function checkAnswer(selectedIndex) {
      const correctIndex = questions[currentQuestionIndex].answer;

      if (!answered.includes(currentQuestionIndex)) {
        if (selectedIndex === correctIndex) {
          score++;
        }
        answered.push(currentQuestionIndex);
        alert(selectedIndex === correctIndex ? "Correct!" : `Wrong! Correct answer: ${questions[currentQuestionIndex].options[correctIndex]}`);
      } else {
        alert("You already answered this question.");
      }

      currentQuestionIndex++;
      loadQuestion();
    }

    function showScore() {
      document.getElementById("quiz-container").style.display = "none";
      document.getElementById("score-container").style.display = "block";
      document.getElementById("score-text").textContent = `You scored ${score} out of ${questions.length}!`;

      localStorage.clear();
    }

    function finishQuiz() {
      showScore();
    }

    function restartQuiz() {
      score = 0;
      currentQuestionIndex = 0;
      answered = [];
      localStorage.clear();

      document.getElementById("quiz-container").style.display = "block";
      document.getElementById("score-container").style.display = "none";

      loadQuestion();
    }

    function populateDropdown() {
      const select = document.getElementById("questionSelect");
      select.innerHTML = "";
      questions.forEach((_, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = index + 1;
        select.appendChild(option);
      });
    }

    function goToQuestion() {
      const index = parseInt(document.getElementById("questionSelect").value);
      currentQuestionIndex = index;
      loadQuestion();
    }

    function saveProgress() {
      localStorage.setItem("currentIndex", currentQuestionIndex);
      localStorage.setItem("score", score);
      localStorage.setItem("answered", JSON.stringify(answered));
    }

    fetchQuestions();
  </script>
</body>
</html>
